<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ã€æ ¸å¿ƒç®¡ç†ã€‘è’¼è²“æ¨¡å‹æ‡¸è³åå–®</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@900&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; background-color: #1a1a1a; 
            background-size: cover; background-position: center; background-attachment: fixed;
            display: flex; flex-direction: column; align-items: center; color: #f1f1f1; margin: 0; padding: 20px;
        }
        h1 { font-size: 50px; color: #ffcc33; filter: drop-shadow(2px 2px 0px #000); }
        #poster-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 30px; }
        .poster-wrapper { position: relative; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 12px; border: 1px solid #444; }
        .wanted-poster {
            width: 280px; background-color: #dfc9a5; background-image: url('https://www.transparenttextures.com/patterns/papyros.png');
            padding: 20px; color: #3e2723; text-align: center; border: 1px solid #bc9b6a; position: relative;
        }
        .photo-area { width: 100%; height: 180px; border: 4px solid #3e2723; overflow: hidden; position: relative; background: #ddd; }
        .photo-area img { width: 100%; height: 100%; object-fit: cover; position: absolute; }
        .controls { background: rgba(30, 30, 30, 0.95); padding: 25px; border-radius: 20px; margin-top: 40px; width: 420px; border: 2px solid #ffcc33; backdrop-filter: blur(10px); }
        input { width: 100%; margin-bottom: 15px; padding: 10px; border-radius: 5px; border: 1px solid #444; background: #000; color: white; box-sizing: border-box; }
        .main-btn { width: 100%; padding: 15px; background: #e67e22; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px; font-size: 16px; }
        .sync-btn { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; }
        .delete-btn { position: absolute; top: -10px; right: -10px; background: #ff4444; color: white; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; border: 2px solid white; font-weight: bold; }
        .move-row { display: flex; justify-content: center; gap: 5px; margin-top: 5px; }
        .btn-move { background: #555; color: white; border: none; padding: 8px 12px; cursor: pointer; border-radius: 4px; }
        #status { margin-top: 15px; text-align: center; font-weight: bold; }
    </style>
</head>
<body>

    <h1>æ‡¸è³åå–®ç®¡ç†å¾Œå°</h1>
    <div id="poster-container">è¼‰å…¥è³‡æ–™ä¸­...</div>

    <div class="controls">
        <label>ğŸ–¼ï¸ ç¶²é å¤§èƒŒæ™¯åœ– (ä¸Šå‚³)</label>
        <input type="file" id="bgUpload" accept="image/*" onchange="encodeImage(this, 'bg')">

        <label>ç¨±è™Ÿ / ç½ªå</label>
        <input type="text" id="crimeInput" placeholder="ä¾‹å¦‚ï¼šé¤˜è¦æ±‚åŠ ä¸Š">
        
        <label>å°è±¡åç¨±</label>
        <input type="text" id="nameInput" placeholder="ä¾‹å¦‚ï¼šåå­—äº”å€‹å­—">
        
        <label>é‡‘é¡</label>
        <input type="number" id="bountyInput" placeholder="30000000">
        
        <label>ğŸ‘¤ äººç‰©ç…§ç‰‡ (ä¸Šå‚³)</label>
        <input type="file" id="imgUpload" accept="image/*">
        
        <button class="main-btn" onclick="addPoster()">æ–°å¢æ‡¸è³ä»¤</button>
        <button class="sync-btn" onclick="syncToGitHub()">ğŸš€ åŒæ­¥ä¸¦ç™¼ä½ˆåˆ°å‰å°</button>
        <p id="status"></p>
    </div>

    <script>
        let postersData = [];
        let config = {
            token: "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", 
            user: "timcause-bbnet",
            repo: "wanted-list",
            bg: ""
        };

        // åˆå§‹åŒ–ï¼šè‡ªå‹•æŠ“å– GitHub ä¸Šçš„å­˜æª”
        window.onload = async function() {
            const url = `https://api.github.com/repos/${config.user}/${config.repo}/contents/data.json`;
            try {
                const res = await fetch(url, { headers: { "Authorization": `token ${config.token}` } });
                if (res.ok) {
                    const json = await res.json();
                    const content = JSON.parse(decodeURIComponent(escape(atob(json.content))));
                    postersData = content.posters || [];
                    config.bg = content.bg || "";
                    if (config.bg) document.body.style.backgroundImage = `url(${config.bg})`;
                }
            } catch (e) { console.log("ç›®å‰å°šç„¡å­˜æª”è³‡æ–™"); }
            render();
        };

        // åœ–ç‰‡è½‰ Base64
        function encodeImage(input, type) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (type === 'bg') {
                        config.bg = e.target.result;
                        document.body.style.backgroundImage = `url(${e.target.result})`;
                    }
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function addPoster() {
            const imgInput = document.getElementById('imgUpload');
            if (!imgInput.files[0]) { alert("è«‹å…ˆä¸Šå‚³äººç‰©ç…§ç‰‡ï¼"); return; }

            const reader = new FileReader();
            reader.onload = (e) => {
                const data = {
                    id: Date.now(),
                    crime: document.getElementById('crimeInput').value || "",
                    name: document.getElementById('nameInput').value || "UNKNOWN",
                    bounty: "à¸¿ " + Number(document.getElementById('bountyInput').value).toLocaleString() + "-",
                    img: e.target.result, // å­˜å…¥ Base64 åœ–ç‰‡
                    top: "0px", left: "0px"
                };
                postersData.push(data);
                render();
            };
            reader.readAsDataURL(imgInput.files[0]);
        }

        function render() {
            const container = document.getElementById('poster-container');
            container.innerHTML = postersData.length ? "" : "<p>ç›®å‰åå–®ç‚ºç©º</p>";
            postersData.forEach((p, index) => {
                const div = document.createElement('div');
                div.className = "poster-wrapper";
                div.innerHTML = `
                    <button class="delete-btn" onclick="removePoster(${index})">X</button>
                    <div class="wanted-poster">
                        <div style="font-size:40px; font-family:Impact;">WANTED</div>
                        <div class="photo-area"><img src="${p.img}" style="top:${p.top}; left:${p.left}; transform:scale(1.2);"></div>
                        <div style="font-size:12px; margin:5px 0; border-top:1px solid #3e2723; border-bottom:1px solid #3e2723;">DEAD OR ALIVE</div>
                        <div style="font-size:12px; font-weight:bold;">${p.crime}</div>
                        <div style="font-size:24px; font-family:Impact;">${p.name}</div>
                        <div style="font-size:16px; font-family:Impact;">${p.bounty}</div>
                    </div>
                    <div class="move-controls">
                        <div class="move-row"><button class="btn-move" onclick="moveImg(${index},'up')">â†‘</button></div>
                        <div class="move-row">
                            <button class="btn-move" onclick="moveImg(${index},'left')">â†</button>
                            <button class="btn-move" onclick="moveImg(${index},'down')">â†“</button>
                            <button class="btn-move" onclick="moveImg(${index},'right')">â†’</button>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function moveImg(index, dir) {
            let p = postersData[index];
            let t = parseInt(p.top) || 0; let l = parseInt(p.left) || 0;
            if(dir==='up') t-=10; if(dir==='down') t+=10;
            if(dir==='left') l-=10; if(dir==='right') l+=10;
            p.top = t+"px"; p.left = l+"px";
            render();
        }

        function removePoster(index) { postersData.splice(index, 1); render(); }

        async function syncToGitHub() {
            const status = document.getElementById('status');
            status.innerText = "â³ åŒæ­¥ä¸­ï¼Œè«‹å‹¿é—œé–‰è¦–çª—...";
            status.style.color = "#ffcc33";
            
            const url = `https://api.github.com/repos/${config.user}/${config.repo}/contents/data.json`;
            const content = btoa(unescape(encodeURIComponent(JSON.stringify({ bg: config.bg, posters: postersData }))));

            try {
                const res = await fetch(url, { headers: { "Authorization": `token ${config.token}` } });
                let sha = "";
                if (res.ok) { const json = await res.json(); sha = json.sha; }

                const putRes = await fetch(url, {
                    method: "PUT",
                    headers: { "Authorization": `token ${config.token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ message: "Update Data", content: content, sha: sha })
                });

                if (putRes.ok) {
                    status.innerText = "âœ… ç™¼ä½ˆæˆåŠŸï¼å‰å°æ›´æ–°ä¸­ã€‚";
                    status.style.color = "#27ae60";
                } else { status.innerText = "âŒ åŒæ­¥å¤±æ•—ã€‚"; status.style.color = "#ff4444"; }
            } catch (e) { status.innerText = "âŒ éŒ¯èª¤ï¼š" + e.message; }
        }
    </script>
</body>
</html>