<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ã€æ ¸å¿ƒç®¡ç†ã€‘è’¼è²“æ¨¡å‹æ‡¸è³åå–®</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@900&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; background-color: #1a1a1a; 
            background-size: cover; background-position: center; background-attachment: fixed;
            display: flex; flex-direction: column; align-items: center; color: #f1f1f1; margin: 0; padding: 20px;
            min-height: 100vh;
        }
        h1 { font-size: 50px; color: #ffcc33; filter: drop-shadow(2px 2px 4px #000); margin: 20px 0; }
        
        #poster-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 30px; margin-bottom: 40px; }
        .poster-wrapper { position: relative; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 12px; border: 1px solid #444; text-align: center; }

        /* æ‡¸è³ä»¤æœ¬é«”æ¨£å¼ - å®Œç¾é‚„åŸ */
        .wanted-poster {
            width: 320px; background-color: #dfc9a5; 
            background-image: url('https://www.transparenttextures.com/patterns/papyros.png');
            padding: 30px 20px 15px 20px; color: #3e2723; text-align: center; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); border: 1px solid #bc9b6a; box-sizing: border-box;
        }
        .wanted-header { font-size: 64px; font-family: 'Impact', sans-serif; font-weight: 900; line-height: 0.8; margin-bottom: 10px; transform: scaleY(1.2); }
        .photo-area { width: 270px; height: 200px; border: 5px solid #3e2723; margin: 0 auto; overflow: hidden; position: relative; background: #ddd; }
        .photo-area img { width: 100%; height: 100%; object-fit: cover; position: absolute; transition: 0.1s; image-rendering: high-quality; }
        .dead-or-alive { font-size: 18px; font-family: 'Impact', sans-serif; margin: 8px 0; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid #3e2723; border-bottom: 1px solid #3e2723; padding: 2px 0; }
        .dead-or-alive::before, .dead-or-alive::after { content: "à¹‘"; font-size: 25px; }
        .crime-display { font-size: 16px; font-weight: bold; margin-bottom: 15px; min-height: 20px; }
        .name-display { font-size: 36px; font-family: 'Impact', sans-serif; text-transform: uppercase; line-height: 1; min-height: 45px; }
        .bounty-display { font-size: 22px; font-family: 'Impact', sans-serif; margin-top: 5px; }
        .bottom-decoration { font-size: 8px; text-align: left; line-height: 1; margin-top: 5px; opacity: 0.8; width: 70%; float: left; }
        .marine-footer { font-size: 26px; font-family: 'Impact', sans-serif; text-align: right; margin-top: -5px; }

        /* æ§åˆ¶é¢æ¿ */
        .controls { background: rgba(30, 30, 30, 0.95); padding: 25px; border-radius: 20px; width: 420px; border: 2px solid #ffcc33; backdrop-filter: blur(10px); }
        .controls label { display: block; margin-bottom: 5px; color: #dfc9a5; font-weight: bold; }
        input { width: 100%; margin-bottom: 15px; padding: 10px; border-radius: 5px; border: 1px solid #444; background: #000; color: white; box-sizing: border-box; }
        
        button { padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; border: none; font-size: 16px; transition: 0.2s; }
        .main-btn { width: 100%; background: #e67e22; color: white; margin-bottom: 10px; }
        .sync-btn { width: 100%; background: #27ae60; color: white; }
        .clear-btn { width: 100%; background: #c0392b; color: white; margin-top: 10px; }
        
        .delete-btn { position: absolute; top: -10px; right: -10px; background: #ff4444; color: white; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; border: 2px solid white; z-index: 10; }
        .move-controls { margin-top: 10px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; }
        .btn-move { background: #555; color: white; font-size: 18px; width: 45px; margin: 2px; }
        #status { margin-top: 15px; text-align: center; font-weight: bold; }
    </style>
</head>
<body>

    <h1>æ‡¸è³åå–®ç®¡ç†å¾Œå°</h1>
    <div id="poster-container">æ­£åœ¨å¾ GitHub è¼‰å…¥è³‡æ–™...</div>

    <div class="controls">
        <label>ğŸ–¼ï¸ ç¶²é å¤§èƒŒæ™¯åœ– (ä¸Šå‚³)</label>
        <input type="file" id="bgUpload" accept="image/*" onchange="encodeBg(this)">

        <label>ç¨±è™Ÿ / ç½ªå</label>
        <input type="text" id="crimeInput" placeholder="ä¾‹å¦‚ï¼š3æŠ½é‡Œé¦™ 2æŠ½å£é‡Œ">
        
        <label>å°è±¡åç¨±</label>
        <input type="text" id="nameInput" placeholder="ä¾‹å¦‚ï¼šåå­—äº”å€‹å­—">
        
        <label>æ‡¸è³é‡‘é¡</label>
        <input type="number" id="bountyInput" placeholder="30000000">
        
        <label>ğŸ‘¤ äººç‰©ç…§ç‰‡ (ä¸Šå‚³)</label>
        <input type="file" id="imgUpload" accept="image/*">
        
        <button class="main-btn" onclick="addPoster()">â• æ–°å¢æ‡¸è³ä»¤</button>
        <button class="sync-btn" onclick="syncToGitHub()">ğŸš€ åŒæ­¥ä¸¦ç™¼ä½ˆ (è¦†è“‹ GitHub)</button>
        <button class="clear-btn" onclick="clearAll()">ğŸ—‘ï¸ ä¸€éµæ¸…ç©ºç›®å‰åå–®</button>
        <p id="status"></p>
    </div>

    <script>
        let postersData = [];
        let config = {
            token: "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", 
            user: "timcause-bbnet",
            repo: "wanted-list",
            bg: ""
        };

        // åˆå§‹åŒ–ï¼šè‡ªå‹•è¼‰å…¥
        window.onload = async function() {
            const status = document.getElementById('status');
            const url = `https://api.github.com/repos/${config.user}/${config.repo}/contents/data.json`;
            try {
                const res = await fetch(url, { headers: { "Authorization": `token ${config.token}` } });
                if (res.ok) {
                    const json = await res.json();
                    const content = JSON.parse(decodeURIComponent(escape(atob(json.content))));
                    postersData = content.posters || [];
                    config.bg = content.bg || "";
                    if (config.bg) document.body.style.backgroundImage = `url(${config.bg})`;
                    status.innerText = "âœ… è³‡æ–™è¼‰å…¥æˆåŠŸ";
                } else { status.innerText = "â„¹ï¸ GitHub å°šç„¡å­˜æª”"; }
            } catch (e) { status.innerText = "âŒ è¼‰å…¥å¤±æ•—"; }
            render();
        };

        function encodeBg(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    config.bg = e.target.result;
                    document.body.style.backgroundImage = `url(${e.target.result})`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function addPoster() {
            const imgInput = document.getElementById('imgUpload');
            if (!imgInput.files[0]) { alert("è«‹ä¸Šå‚³ç…§ç‰‡ï¼"); return; }
            const reader = new FileReader();
            reader.onload = (e) => {
                postersData.push({
                    id: Date.now(),
                    crime: document.getElementById('crimeInput').value || "",
                    name: document.getElementById('nameInput').value || "UNKNOWN",
                    bounty: "à¸¿ " + Number(document.getElementById('bountyInput').value).toLocaleString() + "-",
                    img: e.target.result,
                    top: "0px", left: "0px"
                });
                render();
            };
            reader.readAsDataURL(imgInput.files[0]);
        }

        function render() {
            const container = document.getElementById('poster-container');
            container.innerHTML = postersData.length ? "" : "<p>ç›®å‰åå–®ç‚ºç©º</p>";
            postersData.forEach((p, index) => {
                const div = document.createElement('div');
                div.className = "poster-wrapper";
                div.innerHTML = `
                    <button class="delete-btn" onclick="removePoster(${index})">X</button>
                    <div class="wanted-poster">
                        <div class="wanted-header">WANTED</div>
                        <div class="photo-area"><img src="${p.img}" style="top:${p.top}; left:${p.left}; transform:scale(1.2);"></div>
                        <div class="dead-or-alive">DEAD OR ALIVE</div>
                        <div class="crime-display">${p.crime}</div>
                        <div class="name-display">${p.name}</div>
                        <div class="bounty-display">${p.bounty}</div>
                        <div class="bottom-decoration">
                            KONO SAKUHIN WA FICTION DETHUNODE JITSUSAINO Jäººç‰© BUTSU DAITAI SONOTA NO SOSHIKI TO DOITSU NO MEISHOU GA GEKICHU NI TOUJO SHITEMO JITSUSAINO MONO TO WA ISSAI MUKANKEIDETHU.
                        </div>
                        <div class="marine-footer">MARINE</div>
                        <div style="clear:both;"></div>
                    </div>
                    <div class="move-controls">
                        <button class="btn-move" onclick="moveImg(${index},'up')">â†‘</button><br>
                        <button class="btn-move" onclick="moveImg(${index},'left')">â†</button>
                        <button class="btn-move" onclick="moveImg(${index},'down')">â†“</button>
                        <button class="btn-move" onclick="moveImg(${index},'right')">â†’</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function moveImg(index, dir) {
            let p = postersData[index];
            let t = parseInt(p.top) || 0, l = parseInt(p.left) || 0;
            if(dir==='up') t-=10; if(dir==='down') t+=10; if(dir==='left') l-=10; if(dir==='right') l+=10;
            p.top = t+"px"; p.left = l+"px"; render();
        }

        function removePoster(index) { postersData.splice(index, 1); render(); }
        function clearAll() { if(confirm("ç¢ºå®šæ¸…ç©ºå—ï¼Ÿ")) { postersData = []; render(); } }

        async function syncToGitHub() {
            const status = document.getElementById('status');
            status.innerText = "â³ åŒæ­¥ä¸­ï¼Œåœ–ç‰‡å¤§è«‹ç¨å€™...";
            status.style.color = "#ffcc33";
            const url = `https://api.github.com/repos/${config.user}/${config.repo}/contents/data.json`;
            const content = btoa(unescape(encodeURIComponent(JSON.stringify({ bg: config.bg, posters: postersData }))));
            try {
                const res = await fetch(url, { headers: { "Authorization": `token ${config.token}` } });
                let sha = "";
                if (res.ok) { const json = await res.json(); sha = json.sha; }
                const putRes = await fetch(url, {
                    method: "PUT",
                    headers: { "Authorization": `token ${config.token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ message: "Update Data", content: content, sha: sha })
                });
                if (putRes.ok) { status.innerText = "âœ… åŒæ­¥æˆåŠŸï¼"; status.style.color = "#27ae60"; }
                else { status.innerText = "âŒ å¤±æ•—ï¼šæª”æ¡ˆå¯èƒ½éå¤§æˆ– Token éŒ¯èª¤ã€‚"; status.style.color = "#ff4444"; }
            } catch (e) { status.innerText = "âŒ éŒ¯èª¤ï¼š" + e.message; }
        }
    </script>
</body>
</html>